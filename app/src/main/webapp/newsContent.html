<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>骡窝日报详情</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="/js/bootstrap-4.1.1-dist/css/bootstrap.min.css">
    <script src="/js/jquery/jquery.min.js"></script>
    <script src="/js/bootstrap-4.1.1-dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="/css/font/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="/css/reset.css"/>
    <link rel="stylesheet" href="/css/newsContent.css">
    <script src="/js/plugins/jrender/jrender.min.js"></script>
    <link rel="stylesheet" href="/js/plugins/dialog2/dialog.css"/>
    <script src="/js/plugins/dialog2/dialog.min.js"></script>
    <script src="/js/common.js"></script>
    <script src="/js/plugins/inputbox/dist/mDialogMin.js"></script>
    <link rel="stylesheet" href="/js/plugins/inputbox/dist/dialog.css">

    <script>
        $(function () {
            //获取到文章的id
            var params = getParams();
            //获取到当前用户的id
            var user = JSON.parse(sessionStorage.getItem("user"));
            if (params.id) {

                $.get("/dailies/" + params.id, function (data) {
                    $('.newsDetail').renderValues(data)
                })
            }
           //初始化点赞、收藏功能
            $.get("/praiseCollects/parent",{ParentId:params.id},function (data) {
                console.log(data);
                if (data[0].praise == 1) {
                    $("#likeBtn").removeClass().addClass("fa fa-thumbs-up");
                }
                if (data[0].collect == 1) {
                    $("#collectBtn").removeClass().addClass("fa fa-star");
                }
            });
            //点赞、收藏评论
            $(".d-flex i").click(function () {
                var data;
                var collect = 0;
                var praise = 0;
                if ($(this).data("id") == 1) {//点赞
                    var item = sessionStorage.getItem("user");
                    if (!item) {
                        window.location.href = "/login.html";
                        return;
                    }
                    if ($("#likeBtn").hasClass("fa-thumbs-o-up")) {
                        praise = 1;
                        $("#likeBtn").removeClass().addClass("fa fa-thumbs-up");
                    } else {
                        $("#likeBtn").removeClass().addClass("fa fa-thumbs-o-up");
                        praise = 0;
                    }
                    data = {
                        typeFlag: 2,//标识日报点赞
                        typeId: user.id,
                        parentId: params.id,
                        praise: praise
                    };
                    $.post("/praiseCollects/praise",data, function (data) {

                    });
                }else if ($(this).data("id") == 3){   //收藏
                    //判断用户是否登陆
                    var item = sessionStorage.getItem("user");
                    if (!item) {
                        window.location.href = "/login.html";
                        return;
                    }
                    if ($("#collectBtn").hasClass("fa fa-star-o")) {
                        $("#collectBtn").removeClass().addClass("fa fa-star");
                        collect = 1;
                    } else {
                        $("#collectBtn").removeClass().addClass("fa fa-star-o");
                        collect = 0;
                    }
                    data = {
                        typeId: user.id,
                        parentId: params.id,
                        collect: collect
                    };
                        $.post("/praiseCollects/praise",data, function (data) {

                        });
                }
            });
        })
    </script>

</head>

<body>
<div class="newsDetail">
    <div >
        <a href="javascript:history.go(-1);" style="position: absolute;top: 10px;left: 22px;">
            <span><i class="fa fa-chevron-left fa-2x" style="color: white;"></i></span>
        </a>
        <img render-src="coverUrl">

        <div class="container">
            <div class="row typeRow">
                <div class="col-4">
                    <span class="type">美图美文</span>
                </div>
                <div class="col-2">
                </div>
                <div class="col-2">
                    <span>By</span>
                </div>
                <div class="col-4">
                    <span class="type">骡窝官方</span>
                </div>
            </div>

            <div class="detail">
                <h2 class="title" render-html="title"></h2>
                <div class="content"  render-html="content.content">

                </div>
            </div>
            <div class="container d-flex">
                <div class="p-2  flex-fill fa-2x">
                    <i data-id="1" class="fa fa-thumbs-o-up" id="likeBtn"> </i>
                </div>
                <div class="p-2  flex-fill fa-2x">
                    <i data-id="2" class="fa  fa-commenting-o" id="commentBtn"> </i>
                </div>
                <div class="p-2  flex-fill fa-2x">
                    <i data-id="3" class="fa fa-star-o" id="collectBtn"> </i>
                </div>
            </div>
        </div>
    </div>

</div>
</body>
</html>